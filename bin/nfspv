#!/bin/bash

if [ -z $1 ]; then
    echo "Usage: ./bin/nfspv pv-name [-p /path/on/nfs/server] [-s Size]";
    exit 0;
fi

cd $(dirname $0)/../kubernetes/storage

NAME=$1
NFS_PATH="/"
SIZE="8Gi"
NAMESPACE=default

ARGS=$1; shift

while getopts ':p:s:n:' opt; do
    case ${opt} in
        n)
            NAMESPACE=$OPTARG;;
	    p)
            NFS_PATH=$OPTARG;;
	    s)
            SIZE=$OPTARG;;
	esac
done

shift $((OPTIND -1))

mkdir -p $NAMESPACE

/usr/bin/cat > $NAMESPACE/pv-$NAME.yaml <<EOF
apiVersion: v1
kind: PersistentVolume
metadata:
  name: $NAMESPACE-$NAME
spec:
  capacity:
    storage: $SIZE
  volumeMode: Filesystem
  accessModes:
    - ReadWriteMany
  mountOptions:
    - hard
    - nfsvers=4.1
  nfs:
    server: nas.fnptr.net
    path: "$NFS_PATH"
EOF